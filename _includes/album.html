<section class="ut-wrap">
  <h2 class="ut-section">Architecture</h2>

  <div class="ut-grid">

    <article class="ut-card"
      data-title="BASIC PORTFOLIO TILE"
      data-subtitle="Design, Photography"
      data-note="这里写详细注释（可以很长）：地点、学校、路线、年份、空间观察……"
      data-images='["/images/universitour/Brown1.jpg","/images/universitour/Brown2.jpg"]'>

      <div class="ut-media">
        <div class="ut-photo" style="background-image:url('/images/universitour/Brown1.jpg')"></div> 

        <button class="ut-arrow ut-left" type="button" aria-label="Prev">‹</button>
        <button class="ut-arrow ut-right" type="button" aria-label="Next">›</button>
      </div>

      <div class="ut-meta">
        <div class="ut-title">BASIC PORTFOLIO TILE</div>
        <div class="ut-sub">Design, Photography</div>
      </div>
    </article>

    <article class="ut-card"
      data-title="BASIC PORTFOLIO TILE"
      data-subtitle="Design, Photography"
      data-note="第二张卡片的详细注释……"
      data-images='["/images/universitour/ShanghaiTech1.JPEG","/images/universitour/ShanghaiTech2.JPEG"]'>

      <div class="ut-media">
        <div class="ut-photo" style="background-image:url('/images/universitour/ShanghaiTech1.JPEG')"></div> 
        <button class="ut-arrow ut-left" type="button" aria-label="Prev">‹</button>
        <button class="ut-arrow ut-right" type="button" aria-label="Next">›</button>
      </div>

      <div class="ut-meta">
        <div class="ut-title">BASIC PORTFOLIO TILE</div>
        <div class="ut-sub">Design, Photography</div>
      </div>
    </article>

    <article class="ut-card"
      data-title="BASIC PORTFOLIO TILE"
      data-subtitle="Design, Photography"
      data-note="第三张卡片的详细注释……"
      data-images='["/images/universitour/UiB1.jpg"]'>

      <div class="ut-media">
        <div class="ut-photo" style="background-image:url('/images/universitour/UiB1.jpg')"></div> 
        <button class="ut-arrow ut-left" type="button" aria-label="Prev">‹</button>
        <button class="ut-arrow ut-right" type="button" aria-label="Next">›</button>
      </div>

      <div class="ut-meta">
        <div class="ut-title">BASIC PORTFOLIO TILE</div>
        <div class="ut-sub">Design, Photography</div>
      </div>
    </article>

  </div>


  <!-- 再加一个分类（无限往下加） -->
  <h2 class="ut-section">Street / Detail</h2>
  <div class="ut-grid">
    <article class="ut-card"
      data-title="Another Tile"
      data-subtitle="Campus, 2025"
      data-note="这里是另一个分类下的说明……"
      data-images='["/images/universitour/d1.jpg","/images/universitour/d2.jpg"]'>

      <div class="ut-media">
        <div class="ut-photo" style="background-image:url('/images/universitour/Brown1.jpg')"></div> 
        <button class="ut-arrow ut-left" type="button" aria-label="Prev">‹</button>
        <button class="ut-arrow ut-right" type="button" aria-label="Next">›</button>
      </div>

      <div class="ut-meta">
        <div class="ut-title">Another Tile</div>
        <div class="ut-sub">Campus, 2025</div>
      </div>
    </article>
  </div>
</section>

<!-- 图2风格弹窗 -->
<div class="ut-modal" id="utModal" aria-hidden="true">
  <div class="ut-modal-box" role="dialog" aria-modal="true">
    <button class="ut-close" type="button" aria-label="Close">×</button>

    <!-- 顶部条（图2那种一排） -->
    <div class="ut-strip" id="utStrip"></div>

    <!-- 三角 + 说明框 -->
    <div class="ut-bubble-area">
      <div class="ut-pointer" id="utPointer"></div>
      <div class="ut-bubble">
        <div class="ut-bt" id="utBT"></div>
        <div class="ut-bs" id="utBS"></div>
        <div class="ut-bn" id="utBN"></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const cards = Array.from(document.querySelectorAll('.ut-card'));
  const modal = document.getElementById('utModal');
  const strip = document.getElementById('utStrip');
  const pointer = document.getElementById('utPointer');

  const BT = document.getElementById('utBT');
  const BS = document.getElementById('utBS');
  const BN = document.getElementById('utBN');

  let activeCard = 0;

  const parse = (card) => ({
    title: card.dataset.title || '',
    subtitle: card.dataset.subtitle || '',
    note: card.dataset.note || '',
    images: JSON.parse(card.dataset.images || '[]')
  });

  // 卡片内部左右切换（固定区域 + 循环）
  cards.forEach((card) => {
    const img = card.querySelector('.ut-photo');
    const left = card.querySelector('.ut-left');
    const right = card.querySelector('.ut-right');
    const data = parse(card);
    let i = 0;

    const render = () => { if (data.images.length) img.src = data.images[i]; };

    left.addEventListener('click', (e) => {
      e.stopPropagation();
      if (!data.images.length) return;
      i = (i - 1 + data.images.length) % data.images.length;
      render();
    });

    right.addEventListener('click', (e) => {
      e.stopPropagation();
      if (!data.images.length) return;
      i = (i + 1) % data.images.length;
      render();
    });

    // 点击卡片弹窗
  card.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    activeCard = cards.indexOf(card);
    openModal();
  });

  function buildStrip() {
    strip.innerHTML = '';
    cards.forEach((card, idx) => {
      const data = parse(card);
      const thumb = (data.images[0] || card.querySelector('.ut-photo').src);

      const item = document.createElement('button');
      item.type = 'button';
      item.className = 'ut-strip-item' + (idx === activeCard ? ' is-active' : '');
      item.innerHTML = `
        <div class="ut-thumb"><img src="${thumb}" alt=""></div>
        <div class="ut-smeta">
          <div class="ut-sname">${data.title}</div>
          <div class="ut-srole">${data.subtitle}</div>
        </div>
      `;
      item.addEventListener('click', () => {
        activeCard = idx;
        updateModal();
        buildStrip();
        movePointer();
      });
      strip.appendChild(item);
    });
  }

  function updateModal() {
    const data = parse(cards[activeCard]);
    BT.textContent = data.title;
    BS.textContent = data.subtitle;
    BN.textContent = data.note;
  }

  function movePointer() {
    const active = strip.querySelector('.ut-strip-item.is-active');
    if (!active) return;
    const stripRect = strip.getBoundingClientRect();
    const rect = active.getBoundingClientRect();
    const x = (rect.left - stripRect.left) + rect.width / 2;
    pointer.style.left = x + 'px';
  }

  function openModal() {
    buildStrip();
    updateModal();
    modal.classList.add('is-open');
    modal.setAttribute('aria-hidden', 'false');
    requestAnimationFrame(movePointer);
  }

  function closeModal() {
    modal.classList.remove('is-open');
    modal.setAttribute('aria-hidden', 'true');
  }

  modal.querySelector('.ut-close').addEventListener('click', closeModal);
  modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
  window.addEventListener('resize', () => { if (modal.classList.contains('is-open')) movePointer(); });
});
</script>
